# This workflow generates the Pac-Man contribution graph SVG
# and pushes it to the 'output' branch without overwriting other files.
name: Generate Pac-Man Game

on:
  schedule:
    # Run automatically every 12 hours
    - cron: "0 */12 * * *"
  workflow_dispatch: # Allows manual triggering
  push:
    branches:
      - main

jobs:
  generate:
    # Note: permissions are required for the push action
    permissions:
      contents: write 
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Create 'dist' directory
        run: mkdir -p dist

      # 1. Generate the Pac-Man file into the 'dist' directory
      - name: Generate Pac-Man Game SVG
        uses: abozanona/pacman-contribution-graph@main
        with:
          github_user_name: ${{ github.repository_owner }}
          # Output files explicitly directed to 'dist'
          output_file: dist/pacman-contribution-graph.svg
          output_file_dark: dist/pacman-contribution-graph-dark.svg
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # 2. PUSH: Commit and push the generated files to the 'output' branch.
      # This action is configured to commit only new/changed files, preserving existing content.
      - name: Push generated Pac-Man SVG to output branch
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Target branch to push the changes to
          branch: output
          # Only commit files within the 'dist' directory
          file_pattern: 'dist/*'
          commit_message: "chore: Update Pac-Man contribution graph"
